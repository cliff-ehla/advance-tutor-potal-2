<script context="module">
	import {org_store} from "../store";
	import {get} from 'svelte/store'
	import {getUserOrgData} from "../api/tutor-api";
	export const load = async ({fetch, session}) => {
		if (!get(org_store).id) {
			await getUserOrgData(fetch)
		}
		return {
			props: {
				user_info: session.user_info
			}
		}
	}
</script>

<script>
	import {sentry} from "$lib/sentry";
	import LoadingBar from '$lib/ui/indeterminate-loading-bar.svelte'
	import {navigating} from "$app/stores";
	import '../styles/tailwind-output.css';
	import {onMount} from 'svelte'
	import Notification from '../components/app-shelf/notification.svelte'
	import Modal from '../components/app-shelf/modal.svelte'
	import Popup from '../components/app-shelf/popup.svelte'
	import Popper from '../components/app-shelf/popper.svelte'
	import TopBar from '$lib/app-shelf/top-bar.svelte'
	import {session} from '$app/stores'

	export let user_info

	onMount(() => {
		sentry.init()
	})
</script>

{#if $session.user_info}
	<TopBar/>
{/if}

{#if $navigating}
	<div class="fixed inset-x-0 top-0 z-50">
		<LoadingBar/>
	</div>
{/if}

<Notification>
	<Modal>
		<Popup>
			<Popper>
				<main class="transition transition-all">
					<slot></slot>
				</main>
			</Popper>
		</Popup>
	</Modal>
</Notification>