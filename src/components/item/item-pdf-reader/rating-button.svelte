<script>
	import {getContext} from "svelte";
	import RateZoom from '../../zoom/rate-zoom.svelte'
	const {showPopper} = getContext('popper')
	import {onMount} from 'svelte'
	import {getZoomMaterialRating} from "../../../api/zoom-api";
	import tippy from "tippy.js";

	export let student_id
	export let item_id

	let t_difficulty_rate
	let loaded = false

	onMount(async () => {
		let result = await getZoomMaterialRating({student_id, item_id})
		t_difficulty_rate = result.t_difficulty_rate
		loaded = true
	})

	const tooltip = (node) => {
		const showTooltip = (rate) => {
			tippy(node, {
				content: !rate ? 'Rate the material for the student' : `Rated: ${rate}`,
				placement: 'right'
			})
		}
		return {
			update: showTooltip
		}
	}

	const onRateZoom = (e) => {
		showPopper(e.target, RateZoom, {
			t_difficulty_rate,
			student_id,
			item_id,
			is_standalone_style: true,
			onRateSuccess: (v) => {
				t_difficulty_rate = v
			}
		}, {
			placement: 'right',
			offset: '10'
		})
	}
</script>

<button use:tooltip={t_difficulty_rate} on:click={onRateZoom} class="shadow bg-white rounded-full w-16 h-16 flex items-center justify-center hover:bg-gray-100 hover:text-blue-500 focus:outline-none">
	{#if loaded}
		{#if t_difficulty_rate}
			<svg class="w-10" viewBox="0 0 485 490" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" clip-rule="evenodd" d="M353.38 128C355.599 133.214 357.584 138.552 359.323 144H359.168C364.88 161.856 368 180.688 368 200C368 202.68 367.912 205.344 367.8 208H367.829C367.598 213.397 367.135 218.733 366.449 224H366.384C364.944 235 362.56 245.696 359.256 256H359.323C357.584 261.448 355.599 266.786 353.38 272H353.312C342.848 296.504 327.224 318.304 307.8 336H307.937C301.59 341.788 294.836 347.137 287.723 352H287.552C267.144 365.944 243.8 375.864 218.656 380.68L218.668 380.739C214.938 381.45 211.168 382.049 207.362 382.531L278.349 453.056L466.737 263L485 281.263L296.672 471.275L296.759 471.361L278.496 489.607L174 385.767L175.938 383.824C172.316 383.667 168.719 383.404 165.152 383.04L165.151 383.046C159.796 382.501 154.51 381.727 149.301 380.733L149.312 380.68C64.4317 364.409 0.0723672 289.676 6.06537e-05 200.151L0 200C0 133.84 35.568 72.912 92.952 40.16C102.728 16.616 125.944 0 152.984 0H215.016C242.056 0 265.272 16.616 275.048 40.16C310.6 60.448 337.808 91.52 353.328 128H353.38ZM191.909 367.816C189.287 367.938 186.651 368 184 368C91.36 368 16 292.64 16 200C16 144.656 43.288 93.344 88.144 62.12C88.1287 62.4865 88.1041 62.8496 88.0796 63.2122L88.0795 63.2128C88.0397 63.7998 88 64.3858 88 64.984C88 70.28 88.648 75.56 89.928 80.68C53.584 109.4 32 153.568 32 200C32 283.816 100.184 352 184 352C267.816 352 336 283.816 336 200C336 153.568 314.416 109.4 278.072 80.68C279.352 75.56 280 70.28 280 64.984C280 64.3863 279.96 63.8008 279.921 63.2143L279.921 63.2127V63.2122C279.896 62.8495 279.871 62.4865 279.856 62.12C324.712 93.344 352 144.656 352 200C352 289.783 281.217 363.335 192.521 367.787L192.228 367.496L191.909 367.816ZM184 144C190.824 144 196.952 140.208 200 134.112L200.84 132.424L215.152 139.584L214.312 141.272C208.536 152.824 196.92 160 184 160H168V144H184ZM152 112C152 116.416 155.584 120 160 120C164.416 120 168 116.416 168 112C168 107.584 164.416 104 160 104C155.584 104 152 107.584 152 112ZM208 120C212.416 120 216 116.416 216 112C216 107.584 212.416 104 208 104C203.584 104 200 107.584 200 112C200 116.416 203.584 120 208 120ZM189.656 82.344C180.848 73.536 176 61.832 176 49.368V48H160V49.368C160 66.096 166.512 81.824 178.344 93.656L189.656 82.344ZM176 304V320H192V304H176ZM208 304V320H224V304H208ZM160 304H144V320H160V304ZM48 200C48 274.992 109.008 336 184 336C258.992 336 320 274.992 320 200C320 160.904 302.88 123.608 273.768 97.92L273.136 100.432C277.368 105.864 280 112.6 280 120C280 137.648 265.648 152 248 152H247.28C244.128 170.656 230.216 185.648 212.136 190.384L213.552 193.216C252.752 203.84 280 239.24 280 280V288H88V280C88 239.24 115.248 203.84 154.448 193.216L155.864 190.384C137.792 185.648 123.872 170.656 120.72 152H120C102.352 152 88 137.648 88 120C88 112.6 90.632 105.864 94.864 100.44L94.232 97.92C65.112 123.6 48 160.904 48 200ZM120 104C111.176 104 104 111.176 104 120C104 128.824 111.176 136 120 136V104ZM150.632 211.376L155.576 221.264L168.088 215.008L158.632 208.704C155.896 209.448 153.224 210.344 150.632 211.376ZM194.32 230.104L184 224.944L173.68 230.104L180.28 240H187.72L194.32 230.104ZM104.432 272H148L166.2 247.728L159.256 237.312L148.416 242.728L136.504 218.904C118.8 230.928 106.784 250.136 104.432 272ZM200 272L188 256H180L168 272H200ZM263.568 272C261.216 250.136 249.2 230.928 231.488 218.912L219.576 242.728L208.736 237.312L201.792 247.728L220 272H263.568ZM209.36 208.704L199.904 215.008L212.416 221.264L217.36 211.376C214.768 210.344 212.104 209.448 209.36 208.704ZM172.944 192L170.312 197.264L184 206.384L197.688 197.256L195.056 192H172.944ZM248 104H246.672C247.536 107.272 248 110.664 248 114.12V136C256.824 136 264 128.824 264 120C264 111.176 256.824 104 248 104ZM104 64.984C104 68.992 104.496 72.984 105.464 76.856L108.784 90.136C112.288 88.816 116.04 88 120 88H121.976C125.088 77.28 131.824 67.832 141.376 61.472L147.56 57.344L156.432 70.656L150.248 74.784C141.328 80.728 136 90.68 136 101.408V144C136 161.648 150.352 176 168 176H200C217.648 176 232 161.648 232 144V114.12C232 105.736 227.536 97.856 220.344 93.544L216.456 91.208C201.376 82.152 192 65.6 192 48H208C208 60.008 214.4 71.312 224.696 77.488L228.584 79.824C232.248 82.024 235.432 84.832 238.168 88H248C251.96 88 255.712 88.816 259.216 90.136L262.536 76.864C263.504 72.992 264 68.992 264 64.984C264 37.976 242.024 16 215.016 16H152.984C125.976 16 104 37.976 104 64.984Z" fill="url(#paint0_linear)"/>
				<defs>
					<linearGradient id="paint0_linear" x1="195" y1="362.308" x2="469" y2="357.308" gradientUnits="userSpaceOnUse">
						<stop stop-color="#7A50F4"/>
						<stop offset="1" stop-color="#4083E3"/>
					</linearGradient>
				</defs>
			</svg>
		{:else}
			<svg class="w-10 pointer-events-none" id="_x33_0" enable-background="new 0 0 64 64" height="512" viewBox="0 0 64 64" width="512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="32" x2="32" y1="63" y2="1"><stop offset="0" stop-color="#9f2fff"/><stop offset="1" stop-color="#0bb1d3"/></linearGradient><path d="m24 19c.853 0 1.619-.474 2-1.236l.105-.211 1.789.895-.105.211c-.722 1.444-2.174 2.341-3.789 2.341h-2v-2zm-4-4c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1zm7 1c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1zm-2.293-4.707c-1.101-1.101-1.707-2.564-1.707-4.122v-.171h-2v.171c0 2.091.814 4.057 2.293 5.536zm.293 27.707h-2v2h2zm4 0h-2v2h2zm-8 0h-2v2h2zm42-20v8c0 1.103-.897 2-2 2h-14.202c-.18 1.375-.478 2.712-.891 4h15.093c1.103 0 2 .897 2 2v8c0 1.103-.897 2-2 2h-24.056c-2.551 1.743-5.469 2.983-8.612 3.585l.082.415h32.586c1.103 0 2 .897 2 2v8c0 1.103-.897 2-2 2h-32.286c-.659 1.186-2.457 2-4.714 2-2.851 0-5-1.29-5-3l.02-8.196.644-3.219c-10.616-2.035-18.664-11.386-18.664-22.585 0-8.27 4.446-15.886 11.619-19.98 1.222-2.943 4.124-5.02 7.504-5.02h7.754c3.38 0 6.282 2.077 7.504 5.02 4.444 2.536 7.845 6.42 9.785 10.98h15.834c1.103 0 2 .897 2 2zm-56 7c0 9.374 7.626 17 17 17s17-7.626 17-17c0-4.887-2.14-9.549-5.779-12.76l-.079.314c.529.679.858 1.521.858 2.446 0 2.206-1.794 4-4 4h-.09c-.394 2.332-2.133 4.206-4.393 4.798l.177.354c4.9 1.328 8.306 5.753 8.306 10.848v1h-24v-1c0-5.095 3.406-9.52 8.306-10.848l.177-.354c-2.259-.592-3.999-2.466-4.393-4.798h-.09c-2.206 0-4-1.794-4-4 0-.925.329-1.767.858-2.445l-.079-.315c-3.64 3.21-5.779 7.873-5.779 12.76zm9-12c-1.103 0-2 .897-2 2s.897 2 2 2zm3.829 13.422.618 1.236 1.564-.782-1.182-.788c-.342.093-.676.205-1 .334zm5.461 2.341-1.29-.645-1.29.645.825 1.237h.93zm-11.236 5.237h5.446l2.275-3.034-.868-1.302-1.355.677-1.489-2.978c-2.213 1.503-3.715 3.904-4.009 6.637zm7.946 0h4l-1.5-2h-1zm11.946 0c-.294-2.733-1.796-5.134-4.01-6.636l-1.489 2.977-1.355-.677-.868 1.302 2.276 3.034zm-6.776-7.912-1.182.788 1.564.782.618-1.236c-.324-.129-.657-.241-1-.334zm-4.552-2.088-.329.658 1.711 1.14 1.711-1.141-.329-.657zm9.382-11h-.166c.108.409.166.833.166 1.265v2.735c1.103 0 2-.897 2-2s-.897-2-2-2zm-18-4.877c0 .501.062 1 .183 1.484l.415 1.66c.438-.165.907-.267 1.402-.267h.247c.389-1.34 1.231-2.521 2.425-3.316l.773-.516 1.109 1.664-.773.516c-1.115.743-1.781 1.987-1.781 3.328v5.324c0 2.206 1.794 4 4 4h4c2.206 0 4-1.794 4-4v-3.735c0-1.048-.558-2.033-1.457-2.572l-.486-.292c-1.885-1.132-3.057-3.201-3.057-5.401h2c0 1.501.8 2.914 2.087 3.686l.486.292c.458.275.856.626 1.198 1.022h1.229c.495 0 .964.102 1.402.267l.415-1.659c.121-.484.183-.984.183-1.485 0-3.376-2.747-6.123-6.123-6.123h-7.754c-3.376 0-6.123 2.747-6.123 6.123zm10 37.877c11.58 0 21-9.42 21-21 0-6.918-3.411-13.332-9.018-17.235.005.12.018.237.018.358 0 .662-.081 1.322-.241 1.962 4.543 3.59 7.241 9.111 7.241 14.915 0 10.477-8.523 19-19 19s-19-8.523-19-19c0-5.804 2.698-11.325 7.241-14.915-.16-.64-.241-1.3-.241-1.962 0-.121.013-.238.018-.358-5.607 3.903-9.018 10.317-9.018 17.235 0 11.58 9.42 21 21 21zm3 13v-7h-6v7c0 .249 1.064 1 3 1s3-.751 3-1zm1.805-9 .195 1v7h32v-8zm-2.449-2.12c-.775.079-1.561.12-2.356.12s-1.581-.041-2.356-.12l-.424 2.12h5.561zm18.808-13.88c-1.308 3.063-3.261 5.788-5.689 8h21.525v-8zm15.836-16h-15.104c.714 2.232 1.104 4.586 1.104 7 0 .335-.011.668-.025 1h14.025z" fill="url(#SVGID_1_)"/></svg>
		{/if}
	{/if}
</button>